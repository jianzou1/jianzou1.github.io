---
title: 局内派对点奖励规则
date: 2020-2-20 10:21:17
tags: game-design
---

## 更新日志

| 日期          | 内容                                                         | 作者   |
| ------------- | ------------------------------------------------------------ | :----- |
| 2023年8月14日 | 创建文档                                                     | 朱兴韬 |
| 2023年10月8日 | 明确派对点校验规则<br />明确BOSS死亡后，OGX使用卡牌的派对点去向 | 朱兴韬 |

## 一、设计目的

玩家可以通过在游戏中获取派对点，增加游戏的趣味性和奖励；这个功能的目标是让玩家在游戏中的行为有正向奖励反馈，同时也为OGX在游戏内使用卡牌技能提供正当性。

## 二、功能概述

- 此规则主要围绕派对点的产出、掉落交互、奖池、奖池表现及派对点的局内掉落方式进行设计。
- OGX玩家在游戏中使用技能卡牌将消耗派对点，这些派对点将通过各种方式返回给普通玩家。
  - 玩家通过开启宝箱、击杀NPC等枚举行为可获得派对点。
  - 玩家一旦成功撤离，将根据场上玩家存活的数量，从撤离奖励池获得派对点。


## 三、流程示意图

### 3.1 完整流程

![image-20230915140853929](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230915140853929.png)

### 3.2 抽奖流程

![image-20230918111733363](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230918111733363.png)

## 四、新增配置

### 4.1 `party_point_action_cfg`

- 新增配置表`party_point_action_cfg`，用于配置玩家获得派对点奖励的不同行为。

[TABLE_BEGIN]

| 字段                | 字段名               | 备注                                                         |
| ------------------- | -------------------- | ------------------------------------------------------------ |
| id#string           | 行为id               |                                                              |
| completedAction#int | 玩家完成行为枚举     | 根据枚举类型读取actionValue字段读取参数<br />100=开启宝箱，读取宝箱id<br />200=击杀指定NPC，读取npc的id |
| actionValue#int     | 行为参数             |                                                              |
| actionPro           | 完成该枚举增加的概率 |                                                              |

[TABLE_END]

### 4.2 `party_point_reward_cfg`

- 新增配置表`party_point_reward_cfg`，用于配置玩家获得的派对点奖励。

[CONFIG_BEGIN]

| 字段                  | 字段名                     | 备注                                                       |
| --------------------- | -------------------------- | ---------------------------------------------------------- |
| jackpotPercent#int    | 配置进入奖池的派对币百分比 |                                                            |
| loseAddPro#string     | 每次抽奖失败增加保底概率   | 配置对象<br />第一个数为失败次数<br />第二个数为增加的概率 |
| onceWinEmptyTimes#int | 中奖一次轮空次数           |                                                            |

[CONFIG_END]

[TABLE_BEGIN]

| 字段                 | 字段名       | 备注                                     |
| -------------------- | ------------ | ---------------------------------------- |
| id#int               | 奖励id       |                                          |
| partyPointReward#int | 获得的派对点 | 获得当前奖池内千分比                     |
| pro                  | 档位权重     | 千分比                                   |
| noticeId#int         | 通知id       | 获得该奖励时的全局播报，配空则不触发播报 |

[TABLE_END]

#### 4.2.1 配置示例

`party_point_reward_cfg`
`[`
  `[`
    `{`
      `"jackpotPercent": 500,`
      `"loseAddPro": "{3:1500,5:3000}",`
      `"onceWinEmptyTimes": 5`
    `}`
  `],`
  `[`
    `{`
      `"id": 1,`
      `"partyPointReward": 90,`
      `"pro": "1000",`
      `"noticeId": 500011`
    `},`
    `{`
      `"id": 2,`
      `"partyPointReward": 80,`
      `"pro": "800",`
      `"noticeId": 500011`
    `},`
    `{`
      `"id": 3,`
      `"partyPointReward": 70,`
      `"pro": "600",`
      `"noticeId": 500011`
    `},`
    `{`
      `"id": 4,`
      `"partyPointReward": 60,`
      `"pro": "400",`
      `"noticeId": 500011`
    `},`
    `{`
      `"id": 5,`
      `"partyPointReward": 50,`
      `"pro": "200",`
      `"noticeId": 500011`
    `}`
  `]`
`]`

## 五、功能规则

### 5.1 功能开关

- 判断当前匹配对局内是否有OGX玩家或AI上帝。
  - 如果有OGX玩家或AI上帝：启用派对点奖励规则。
  - 如果没有OGX玩家或AI上帝：禁用派对点奖励规则。

### 5.2 派对点产出

- 局内目前有奖池设计，OGX玩家在局内消耗的所有派对点，都将的方式与来源请查看系统案：[O OB卡牌功能 ](http://doc.easegame/pgproject/designerdoc/-/wikis/新主玩法战斗相关/W-玩法模式/OB模式系统功能/O-OB卡牌功能)。
  - 消耗派对点的途径包括：使用卡牌，读取`ob_card_cfg`配置表的`bonus`字段进行产出。
  - BOSS一旦死亡，OGX玩家消耗的派对点，不进行任何处理。
- 派对点校验：在结算过程中，玩家获得的派对点，不允许大于OGX在局内消耗的派对点，若结算时检测到该情况，则没收玩家所有派对点。

### 5.3 派对点分配

- OGX产出的派对点，一部分进入“派对点奖池”，另一部分进入“撤离奖励池”，分配方式如下：
  - 派对点奖池：OGX产出派对点 * `jackpotPercent`字段，得出的派对点进入派对点奖池。
  - 撤离奖励池：剩余派对点，计入撤离奖励池。

### 5.4 撤离奖励池

- OGX附身的BOSS死亡时，将“派对点奖池”内的所有派对点，计入“撤离奖励池”，派对点奖池不复存在。此后OGX玩家花费的派对点也计入“撤离奖励池”。
- 该奖励不会立即获得，只有成功撤离，进入结算流程的玩家，才可获得从撤离奖励池中分得奖励，具体表现查看系统案：[D 夺金模式 战斗结算](http://doc.easegame/pgproject/designerdoc/-/wikis/新主玩法战斗相关/W-玩法模式/D-夺金模式/D-夺金模式-战斗结算)。
  - 在BOSS死亡时，系统将记录击杀BOSS的队伍与队伍情况，供结算使用。
  - 若为是，则将 撤离奖励池中的派对点数量 / 击杀BOSS时队内存活的玩家数量 = 玩家获得的撤离派对点奖励。玩家获得派对点奖励后，将所获得的派对点从“撤离奖励池”中扣除。


### 5.5 派对点奖池

- 奖池抽取条件：当玩家完成指定的枚举行为时，有可能在派对点奖池中完成一次抽取，枚举行为根据`party_point_action_cfg`配置表的`completedAction`字段读取，具体如下：
  - `100`=开启宝箱，读取`actionValue`的宝箱id。关于夺金模式内开启宝箱的具体规则，查看系统案：夺金模式宝箱规则。
  - `200`=击杀指定NPC，读取`actionValue`的NPC的id。关于夺金模式内击杀NPC的具体规则，查看系统案：NPC系统。
- 奖池抽取概率：能否进行1次抽奖，是由 行为概率 与 保底概率 相加决定的。
  - 完成指定行为后，可根据`party_point_action_cfg`中所完成行为的`actionPro`字段，获得行为概率。
  - 若某次抽奖失败，失败次数+1，失败次数可累加；每次抽奖时根据`party_point_reward_cfg`的`loseAddPro`字段增加抽奖保底概率。
    - `loseAddPro`为对象字段，第一个数配置失败次数，第二个数配置增加的概率。抽奖失败次数≥第一个数时，读取该数组的第二个数增加保底概率，失败次数只会判断对象中最大的失败次数值生效。
    - 玩家成功获得1次抽奖资格后，失败次数清零。

- 奖池轮空：成功进行1次抽取后，玩家的任何行为都不再触发抽奖以及失败次数  ，直到玩家完成的行为次数大于等于`onceWinEmptyTimes`字段值。
- 奖池抽取：玩家获得抽取资格后，进入`party_point_reward_cfg`进行抽取，具体规则如下：
  - 读取各个奖励id的千分比`pro`字段，随机出玩家所获得的奖励。
  - 最终获得的奖励根据随机到奖励实例的`partyPointReward`字段进行配置，该字段配置值为千分比。
    - 当前奖池的派对点总额 * `partyPointReward`字段值，为玩家最终获得的奖励。
  - 玩家获得奖励后，需将获得的派对点从奖池中扣除。
    - 从奖池内获得的派对点，保底为1。
    - 若当前奖池派对点总额为0，则玩家抽取后不会获得任何奖励。
- 玩家从派对点奖池获得的派对点奖励，视为玩家在局内所携带的物品，玩家一旦死亡，其携带的派对点将会作为物品掉落，供其他玩家拾取。

#### 5.5.1 派对点奖池：常态交互

- 当前奖池内派对点的总数量如下图所示，该界面表现为功能常态。

  ![image-20230817113418157](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230817113418157.png)

  - 展示派对点图标、当前奖池内的派对点总额。
  - 每当OGX玩家消耗派对点时，经过分配的派对点，会在派对点总额后方，以加号附带白色数字方式进行动效展示，在动效播放完成后，派对点总额数值应有当前值到目标值的逐步数字跳动表现。
    - 派对点来源展示：派对点增加时，需附带派对点来源信息（OGX使用了什么卡牌导致的奖池派对点增长），如图所示。
    - 卡牌图标读取`ob_card_cfg`配置表的`icon`字段。

#### 5.5.2 派对点奖池：奖池抽取

- 当玩家完成了指定行为，获得派对点时，该界面播放奖池抽取表现。

  ![image-20230815155234198](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230815155234198.png)

  - 组件内出现3个老虎机形式的滚动数字框，框内数字快速跳动，相关的数字停止逻辑如下
    - 若服务端下发的奖励id中`partyPointReward`值为A，则数字有可能表现为：A + A + A 或 A + B + A 或 B + A + A ，三种数字停止逻辑中随机一种进行表现。
    - 数字应该由左至右逐个停止，每个停止时间为0.7秒。
    - B的数值随机在`party_point_reward_cfg`配置表中取与玩家所获得奖励相同的`actionId`的`partyPointReward`进行展示。
  - 数字停止后，玩家获得派对点奖励，播放奖励获得表现。

#### 5.5.3 派对点奖池：奖励获得

- 当玩家获得了派对点奖励，抽取表现播放完成，应播放奖励获得表现。

  ![image-20230815161138019](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230815161138019.png)

  - 展示派对点图标、先展示所获得的百分比，随后百分比数字会变化为根据百分比换算的具体派对点数。
  - 派对点图标从组件中飞出，目标点为背包图标的UI位置，图中“+999”在过程中变为0，同时播放逐步数字跳动表现。
    - 派对点以道具形式进入背包，若此时背包已满，则掉落在场景中。
  - 该表现播放完成后，该界面组件恢复为常态；若当前还有未展示完成的奖励，则恢复为"奖池抽取"态继续播放表现。

#### 5.5.4 派对点奖池：通知相关

- 奖池通知：获得一个派对点奖励时，该奖励ID中的`noticeId`有配置值时，则去`tips_cfg`读取通知信息，进行全局广播。
  - 该奖励的格式应该为：“{0}掠夺了派对奖池，获得了{1}派对点数！”
    - {0} = 玩家昵称
    - {1} = 所获得的派对点数
- BOSS死亡通知：OGX附身的BOSS一旦死亡，则去`tips_cfg`读取通知信息id为`ogx_dead_info`的字段，进行全局广播。
  - 该通知的格式应该为：“BOSS已经死亡，击杀的队伍总计获得{0}派对点！”
    - {0} = 当前撤离奖池中的派对点数


#### 5.5.5 派对点奖池：奖池消失表现

- OGX附身的国王死亡时，将“派对点奖池”内的所有派对点，计入“撤离奖励池”；此时派对点奖池的UI组件应做消失表现。

  ​		![image-20230818182615387](D-%25E5%25A4%25BA%25E9%2587%2591%25E6%25A8%25A1%25E5%25BC%258F-%25E5%25B1%2580%25E5%2586%2585%25E6%25B4%25BE%25E5%25AF%25B9%25E7%2582%25B9%25E5%25A5%2596%25E5%258A%25B1%25E8%25A7%2584%25E5%2588%2599.assets/image-20230818182615387.png)

  - 先播放碎裂特效，碎裂特效播放完成后，UI消失。

## 六、美术需求

| 名称                   | 数量 | 备注                                                         | 参考链接                                                     |
| ---------------------- | ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 派对点奖池界面设计     | 1    | 包含以下子标题中涉及到的界面需求与动效需求<br />5.5.1 派对点奖池：常态交互<br />5.5.2 派对点奖池：奖池抽取<br />5.5.3 派对点奖池：奖励获得 |                                                              |
| 奖池老虎机特效         | 1    | ![image-20230815172322100](D-夺金模式-局内派对点奖励规则.assets/image-20230815172322100.png) | [无主之地3老虎机](https://www.bilibili.com/video/BV1iK411L7wr/)<br />[无主之地2老虎机](https://www.bilibili.com/video/BV1px411s7f5/?spm_id_from=333.337.search-card.all.click&vd_source=7e779790a51b463b45d8444f81a6b1aa) |
| 奖池UI碎裂特效         | 1    | ![image-20230818182625078](D-夺金模式-局内派对点奖励规则.assets/image-20230818182625078.png) |                                                              |
| 奖励获得派对点飞行特效 | 1    | ![image-20230815172314078](D-夺金模式-局内派对点奖励规则.assets/image-20230815172314078.png) | https://www.bilibili.com/video/BV1BY4y1h7qm<br />10秒~14秒   |
